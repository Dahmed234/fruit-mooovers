[gd_scene load_steps=25 format=3 uid="uid://dcsn06k5woifq"]

[ext_resource type="Script" uid="uid://gbt4mm2ghxhl" path="res://scenes/follower/follower.gd" id="1_jmfn7"]
[ext_resource type="Texture2D" uid="uid://mscp3ld2ynnc" path="res://assets/kenney_1-bit-pack/Tilesheet/colored-transparent_packed.png" id="1_klxf7"]
[ext_resource type="Texture2D" uid="uid://c6m2shbbpxmm2" path="res://assets/cowWithAngel.png" id="2_56twi"]
[ext_resource type="PackedScene" uid="uid://cfp1kmchhvpv" path="res://scenes/ui/health_bar.tscn" id="3_56twi"]
[ext_resource type="AudioStream" uid="uid://ce6s81df1bq16" path="res://sounds/sound effects/Wilhelm_Scream.ogg" id="5_bcchq"]
[ext_resource type="Script" uid="uid://ctab56ctaq3l" path="res://scenes/follower/footstep_player.gd" id="5_odk4b"]
[ext_resource type="AudioStream" uid="uid://bwdf26r1l7y1k" path="res://sounds/sound effects/footstep04.ogg" id="5_x6um6"]

[sub_resource type="CircleShape2D" id="CircleShape2D_jmfn7"]
radius = 204.07721

[sub_resource type="CircleShape2D" id="CircleShape2D_8j6l1"]
radius = 17.5

[sub_resource type="CircleShape2D" id="CircleShape2D_3g3wk"]
radius = 1.6298006

[sub_resource type="Animation" id="Animation_x6um6"]
resource_name = "Death"
length = 1.3333367
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:position")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.3333334),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector2(0, 0), Vector2(0, -200)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:scale")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 1.3333334),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector2(2, 2), Vector2(15.705, 15.705)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite2D:modulate")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 1.3333334),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 1), Color(1, 1, 1, 0.023529412)]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Sprite2D:region_rect")
tracks/3/interp = 1
tracks/3/loop_wrap = false
tracks/3/keys = {
"times": PackedFloat32Array(0, 0.06666667, 0.13333334, 0.2, 0.26666668, 0.33333334, 0.4, 0.4666667, 0.53333336, 0.6, 0.6666667, 0.73333335, 0.8, 0.8666667, 0.93333334, 1, 1.0666667, 1.1333333, 1.2),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16), Rect2(0, 0, 16, 16), Rect2(16, 0, 16, 16)]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("Sprite2D:z_index")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [5]
}

[sub_resource type="Animation" id="Animation_56twi"]
length = 0.001
tracks/0/type = "bezier"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:position:x")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/1/type = "bezier"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:position:y")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"handle_modes": PackedInt32Array(0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0),
"times": PackedFloat32Array(0)
}
tracks/2/type = "bezier"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite2D:rotation")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"handle_modes": PackedInt32Array(2),
"points": PackedFloat32Array(0, -0.2, 0, 0.2, 0),
"times": PackedFloat32Array(0)
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Sprite2D:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(2, 2)]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("Sprite2D:position")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0, 0)]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("Sprite2D:modulate")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 1)]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("Sprite2D:region_rect")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Rect2(32, 0, 16, 16)]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("Sprite2D:z_index")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_odk4b"]
resource_name = "spawn"
tracks/0/type = "bezier"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:position:x")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"handle_modes": PackedInt32Array(0, 0),
"points": PackedFloat32Array(0, -0.25, 0, 0.25, 0, 0, -0.0055555566, 0, 0, 0),
"times": PackedFloat32Array(0, 1)
}
tracks/1/type = "bezier"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:position:y")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"handle_modes": PackedInt32Array(0, 0, 0),
"points": PackedFloat32Array(-78.5232, -0.2495342, -2.3852856, 0.13333334, -8.603035, 2.0903625, -0.27984273, -8.125097, 0.04444444, 0, -0.14004247, -0.08683345, -5.0980916, 0, 0),
"times": PackedFloat32Array(0, 0.46666667, 0.73333335)
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite2D:rotation")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.46666667),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [0.0, 6.265732]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Sprite2D:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0, 0.33333334),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector2(32, 32), Vector2(2, 2)]
}

[sub_resource type="Animation" id="Animation_gpyn0"]
resource_name = "walk"
length = 0.46667004
loop_mode = 1
tracks/0/type = "bezier"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:position:x")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"handle_modes": PackedInt32Array(0, 0, 2),
"points": PackedFloat32Array(-8.5, -0.20095214, -30.142822, 0.1, 1.7233777, 4.318307, -0.06666666, -7.655207, 0.033333346, -4.48969, -7.9862537, -0.099999994, -0.98922443, 0, 0),
"times": PackedFloat32Array(0, 0.23333333, 0.46666667)
}
tracks/1/type = "bezier"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Sprite2D:position:y")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"handle_modes": PackedInt32Array(0, 0, 1, 2),
"points": PackedFloat32Array(0, 0, 0, 0.016666668, -3.2500002, -12.828402, -0.054033026, 2.3520534, 0.045945406, -2, 0.02646184, 0, 0, 0, 0, 0.521074, -0.03333333, -28.786423, 0, 0),
"times": PackedFloat32Array(0, 0.1, 0.23333333, 0.46666667)
}
tracks/2/type = "bezier"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Sprite2D:rotation")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"handle_modes": PackedInt32Array(0, 2, 2),
"points": PackedFloat32Array(-0.34660664, -0.2, 0, 0.06666667, -0.25215748, 0.40896666, -0.07777778, 0, 0.07777778, 0, -0.36877543, -0.13333333, -0.02430445, 0, 0),
"times": PackedFloat32Array(0, 0.23333333, 0.46666667)
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_odk4b"]
_data = {
&"Death": SubResource("Animation_x6um6"),
&"RESET": SubResource("Animation_56twi"),
&"spawn": SubResource("Animation_odk4b"),
&"walk": SubResource("Animation_gpyn0")
}

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_gpyn0"]
animation = &"RESET"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_odk4b"]
animation = &"spawn"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_56twi"]
animation = &"walk"
play_mode = 1

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_odk4b"]
xfade_time = 0.5
advance_mode = 2
advance_expression = "is_moving"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_x6um6"]
xfade_time = 0.5
advance_mode = 2
advance_expression = "!is_moving"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_bcchq"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_7t6oc"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_bcchq"]
states/End/position = Vector2(728, 69.088)
states/RESET/node = SubResource("AnimationNodeAnimation_gpyn0")
states/RESET/position = Vector2(304.8, 54.8)
states/Start/position = Vector2(65.600006, 28)
states/spawn/node = SubResource("AnimationNodeAnimation_odk4b")
states/spawn/position = Vector2(167.4, 8.799999)
states/walk/node = SubResource("AnimationNodeAnimation_56twi")
states/walk/position = Vector2(524, 69.2)
transitions = ["RESET", "walk", SubResource("AnimationNodeStateMachineTransition_odk4b"), "walk", "RESET", SubResource("AnimationNodeStateMachineTransition_x6um6"), "spawn", "RESET", SubResource("AnimationNodeStateMachineTransition_bcchq"), "Start", "spawn", SubResource("AnimationNodeStateMachineTransition_7t6oc")]
graph_offset = Vector2(13, -34)

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_7t6oc"]
streams_count = 1
stream_0/stream = ExtResource("5_bcchq")

[node name="Follower" type="CharacterBody2D" node_paths=PackedStringArray("label") groups=["Player"]]
collision_layer = 4
collision_mask = 17
motion_mode = 1
wall_min_slide_angle = 0.0
script = ExtResource("1_jmfn7")
playerDistance = 50.0
BASESPEED = 230
label = NodePath("Label")
wanderDistance = 500.0
health = 250.0

[node name="viewRadius" type="Area2D" parent="."]
position = Vector2(-0.25, -0.25)
scale = Vector2(0.18648437, 0.17880563)
collision_layer = 0
collision_mask = 24

[node name="CollisionShape2D" type="CollisionShape2D" parent="viewRadius"]
position = Vector2(1.340595, -4.194499)
shape = SubResource("CircleShape2D_jmfn7")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture_filter = 1
scale = Vector2(2, 2)
texture = ExtResource("2_56twi")
region_enabled = true
region_rect = Rect2(32, 0, 16, 16)

[node name="Health" parent="Sprite2D" instance=ExtResource("3_56twi")]
offset_left = -14.447837
offset_top = -24.70154
offset_right = 5.552163
offset_bottom = -19.70154

[node name="heldItem" type="Node2D" parent="Sprite2D"]
position = Vector2(2.5, -5.5)
rotation = 0.11716485
scale = Vector2(0.5, 0.5)

[node name="Sprite" type="Sprite2D" parent="Sprite2D/heldItem"]
texture_filter = 1
position = Vector2(1.5077715, -17.731564)
texture = ExtResource("1_klxf7")
region_enabled = true
region_rect = Rect2(512, 160, 16, 16)

[node name="head" type="Node2D" parent="Sprite2D"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
texture_filter = 1
position = Vector2(-0.5, 0)
shape = SubResource("CircleShape2D_8j6l1")

[node name="WanderTimer" type="Timer" parent="."]

[node name="Regen timer" type="Timer" parent="."]
wait_time = 10.0

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
path_desired_distance = 5.0
target_desired_distance = 30.0
avoidance_enabled = true
max_speed = 500.0

[node name="Label" type="Label" parent="."]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -20.0
offset_top = 10.0
offset_right = 20.0
offset_bottom = 33.0
grow_horizontal = 2
grow_vertical = 2
text = "0/0"
horizontal_alignment = 1

[node name="Enemy detection box" type="Area2D" parent="."]
collision_layer = 128
collision_mask = 128

[node name="CollisionShape2D" type="CollisionShape2D" parent="Enemy detection box"]
position = Vector2(-0.5, 0.5)
scale = Vector2(4, 4)
shape = SubResource("CircleShape2D_3g3wk")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_odk4b")
}

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeStateMachine_bcchq")
advance_expression_base_node = NodePath("..")
anim_player = NodePath("../AnimationPlayer")

[node name="DeathSound" type="AudioStreamPlayer2D" parent="."]
stream = SubResource("AudioStreamRandomizer_7t6oc")
pitch_scale = 0.75

[node name="Footsteps" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource("5_x6um6")
volume_db = -7.5
bus = &"New Bus"
script = ExtResource("5_odk4b")
footstep_interval = 0.5
footstep_max_pitch = 1.2
footstep_min_pitch = 0.8

[connection signal="timeout" from="WanderTimer" to="." method="on_timeout"]
[connection signal="timeout" from="Regen timer" to="." method="_regen_timeout"]
[connection signal="velocity_computed" from="NavigationAgent2D" to="." method="_on_navigation_agent_2d_velocity_computed"]
